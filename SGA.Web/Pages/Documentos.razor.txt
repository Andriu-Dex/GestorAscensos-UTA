@page "/documentos"
@attribute [Authorize]
@using SGA.Web.Models
@using SGA.Web.Pages.Components
@inject DocumentosService DocumentosService
@inject DocumentVisualizationService DocumentVisualizationService
@inject HttpClient Http
@inject Blazored.LocalStorage.ILocalStorageService LocalStorage
@inject IToastService ToastService
@inject IJSRuntime JSRuntime

<div class="container mt-4">
    <h3>Gestión de Documentos</h3>
    
    <!-- Componente de Obras Académicas -->
    <ObrasAcademicasComponent 
        solicitudesPendientes="todasSolicitudesObras"
        isLoadingObras="isLoadingObras"
        OnShowObrasModal="ShowObrasModal"
        OnVisualizarDocumento="VisualizarDocumento"
        OnDescargarDocumento="DescargarDocumento"
        OnEditarMetadatos="MostrarEditarMetadatos"
        OnReemplazarArchivo="MostrarReemplazarArchivo"
        OnMostrarMotivoRechazo="MostrarMotivoRechazo"
        OnAgregarComentario="MostrarAgregarComentario"
        OnReenviarSolicitud="ReenviarSolicitud"
        OnEliminarSolicitud="EliminarSolicitud" />

    <!-- Componente de Certificados de Capacitación -->
    <CertificadosCapacitacionComponent 
        solicitudesCertificados="todasSolicitudesCertificados"
        isLoadingCertificados="isLoadingCertificados"
        OnShowCertificadosModal="ShowCertificadosModal"
        OnVisualizarCertificado="VisualizarCertificado"
        OnDescargarCertificado="DescargarCertificado"
        OnEditarCertificado="EditarCertificado"
        OnReemplazarArchivoCertificado="ReemplazarArchivoCertificado"
        OnVerMotivoRechazoCertificado="VerMotivoRechazoCertificado"
        OnEliminarCertificado="EliminarCertificado" />

    <!-- Componente de Evidencias de Investigación -->
    <EvidenciasInvestigacionComponent 
        ShowComponent="true"
        OnEvidenciasChanged="@(async () => await InvokeAsync(StateHasChanged))" />
</div>

<!-- Modales principales -->
<ObrasAcademicasModal 
    IsVisible="showObrasModal"
    IsEnviando="isEnviandoObras"
    OnClose="CloseObrasModal"
    OnEnviarSolicitud="EnviarSolicitudObras"
    @ref="obrasModal" />

<CertificadosCapacitacionModal 
    IsVisible="showCertificadosModal"
    IsEnviando="isEnviandoObras"
    OnClose="CerrarCertificadosModal"
    OnEnviarSolicitud="GuardarCertificados"
    @ref="certificadosModal" />

<!-- Modal para Ver Motivo de Rechazo -->
@if (showMotivoRechazoModal && solicitudSeleccionada != null)
{
    <div class="modal fade show" style="display: block;" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #8a1538; color: white;">
                    <h5 class="modal-title">Motivo de Rechazo</h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="() => showMotivoRechazoModal = false"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <strong>Motivo del rechazo:</strong>
                        <p class="mt-2">@solicitudSeleccionada.MotivoRechazo</p>
                    </div>
                    @if (!string.IsNullOrEmpty(solicitudSeleccionada.ComentariosRevision))
                    {
                        <div class="alert alert-info">
                            <strong>Comentarios adicionales:</strong>
                            <p class="mt-2">@solicitudSeleccionada.ComentariosRevision</p>
                        </div>
                    }
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="() => showMotivoRechazoModal = false">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show"></div>
}

<!-- Modal para Editar Metadatos -->
@if (showEditarMetadatosModal && solicitudSeleccionada != null)
{
    <div class="modal fade show" style="display: block;" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #8a1538; color: white;">
                    <h5 class="modal-title">Editar Metadatos</h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="() => showEditarMetadatosModal = false"></button>
                </div>
                <div class="modal-body">
                    <EditForm Model="metadatosEdicion">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Título *</label>
                                    <InputText class="form-control" @bind-Value="metadatosEdicion.Titulo" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Tipo de Obra *</label>
                                    <InputSelect class="form-select" @bind-Value="metadatosEdicion.TipoObra">
                                        <option value="">Seleccione...</option>
                                        <option value="Libro">Libro</option>
                                        <option value="Artículo">Artículo</option>
                                        <option value="Capítulo">Capítulo</option>
                                        <option value="Ponencia">Ponencia</option>
                                        <option value="Otro">Otro</option>
                                    </InputSelect>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Fecha de Publicación</label>
                                    <InputDate class="form-control" @bind-Value="metadatosEdicion.FechaPublicacion" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Editorial</label>
                                    <InputText class="form-control" @bind-Value="metadatosEdicion.Editorial" />
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Revista</label>
                                    <InputText class="form-control" @bind-Value="metadatosEdicion.Revista" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">ISBN/ISSN</label>
                                    <InputText class="form-control" @bind-Value="metadatosEdicion.ISBN_ISSN" />
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Autores</label>
                            <InputText class="form-control" @bind-Value="metadatosEdicion.Autores" />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descripción</label>
                            <InputTextArea class="form-control" rows="3" @bind-Value="metadatosEdicion.Descripcion" />
                        </div>
                    </EditForm>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="() => showEditarMetadatosModal = false">Cancelar</button>
                    <button type="button" class="btn btn-primary" @onclick="GuardarMetadatos" disabled="@isProcessing">
                        @if (isProcessing)
                        {
                            <span class="spinner-border spinner-border-sm me-2"></span>
                        }
                        Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show"></div>
}

<!-- Modal para Reemplazar Archivo -->
@if (showReemplazarArchivoModal && solicitudSeleccionada != null)
{
    <div class="modal fade show" style="display: block;" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #8a1538; color: white;">
                    <h5 class="modal-title">Reemplazar Archivo</h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="() => showReemplazarArchivoModal = false"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Seleccionar nuevo archivo (PDF, máximo 10MB)</label>
                        <InputFile class="form-control" @ref="inputFileReemplazo" OnChange="OnFileChangeReemplazo" accept=".pdf" />
                    </div>
                    @if (!string.IsNullOrEmpty(archivoReemplazoNombre))
                    {
                        <div class="alert alert-info">
                            <strong>Archivo seleccionado:</strong> @archivoReemplazoNombre
                        </div>
                    }
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="() => showReemplazarArchivoModal = false">Cancelar</button>
                    <button type="button" class="btn btn-primary" @onclick="ReemplazarArchivo" 
                            disabled="@(isProcessing || string.IsNullOrEmpty(archivoReemplazoContenido))">
                        @if (isProcessing)
                        {
                            <span class="spinner-border spinner-border-sm me-2"></span>
                        }
                        Reemplazar
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show"></div>
}

<!-- Modal para Agregar Comentario -->
@if (showAgregarComentarioModal && solicitudSeleccionada != null)
{
    <div class="modal fade show" style="display: block;" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #8a1538; color: white;">
                    <h5 class="modal-title">Agregar Comentario</h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="() => showAgregarComentarioModal = false"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Comentario</label>
                        <textarea class="form-control" rows="4" @bind="nuevoComentario" 
                                placeholder="Escriba su comentario aquí..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="() => showAgregarComentarioModal = false">Cancelar</button>
                    <button type="button" class="btn btn-primary" @onclick="GuardarComentario" 
                            disabled="@(isProcessing || string.IsNullOrWhiteSpace(nuevoComentario))">
                        @if (isProcessing)
                        {
                            <span class="spinner-border spinner-border-sm me-2"></span>
                        }
                        Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show"></div>
}

<!-- Modal para Visualizar PDF -->
@if (showVisualizarPDFModal && !string.IsNullOrEmpty(pdfUrl))
{
    <div class="modal fade show" style="display: block;" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #8a1538; color: white;">
                    <h5 class="modal-title">@pdfNombreArchivo</h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="CerrarVisualizarPDF"></button>
                </div>
                <div class="modal-body p-0">
                    @if (isLoadingPDF)
                    {
                        <div class="text-center p-5">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Cargando...</span>
                            </div>
                            <p class="mt-2">Cargando documento...</p>
                        </div>
                    }
                    else if (!string.IsNullOrEmpty(errorPDF))
                    {
                        <div class="alert alert-danger m-3">
                            @errorPDF
                        </div>
                    }
                    else
                    {
                        <iframe src="@pdfUrl" style="width: 100%; height: 600px; border: none;"></iframe>
                    }
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="CerrarVisualizarPDF">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show"></div>
}

<!-- Modal para Editar Certificado -->
@if (showEditarCertificadoModal && editarCertificadoDto != null && certificadoSeleccionado != null)
{
    <div class="modal fade show" style="display: block;" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #8a1538; color: white;">
                    <h5 class="modal-title">Editar Certificado</h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="CerrarEditarCertificadoModal"></button>
                </div>
                <div class="modal-body">
                    <EditForm Model="editarCertificadoDto">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Nombre del Curso *</label>
                                    <InputText class="form-control" @bind-Value="editarCertificadoDto.NombreCurso" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Institución Oferente *</label>
                                    <InputText class="form-control" @bind-Value="editarCertificadoDto.InstitucionOfertante" />
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Tipo de Capacitación</label>
                                    <InputSelect class="form-select" @bind-Value="editarCertificadoDto.TipoCapacitacion">
                                        <option value="">Seleccione...</option>
                                        <option value="Curso">Curso</option>
                                        <option value="Diplomado">Diplomado</option>
                                        <option value="Seminario">Seminario</option>
                                        <option value="Taller">Taller</option>
                                        <option value="Conferencia">Conferencia</option>
                                        <option value="Otro">Otro</option>
                                    </InputSelect>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Modalidad</label>
                                    <InputSelect class="form-select" @bind-Value="editarCertificadoDto.Modalidad">
                                        <option value="">Seleccione...</option>
                                        <option value="Presencial">Presencial</option>
                                        <option value="Virtual">Virtual</option>
                                        <option value="Híbrida">Híbrida</option>
                                    </InputSelect>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Fecha Inicio</label>
                                    <InputDate class="form-control" @bind-Value="editarCertificadoDto.FechaInicio" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Fecha Fin</label>
                                    <InputDate class="form-control" @bind-Value="editarCertificadoDto.FechaFin" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Horas de Duración</label>
                                    <InputNumber class="form-control" @bind-Value="editarCertificadoDto.HorasDuracion" />
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descripción</label>
                            <InputTextArea class="form-control" rows="3" @bind-Value="editarCertificadoDto.Descripcion" />
                        </div>
                    </EditForm>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="CerrarEditarCertificadoModal">Cancelar</button>
                    <button type="button" class="btn btn-primary" @onclick="GuardarEdicionCertificado" disabled="@isProcessing">
                        @if (isProcessing)
                        {
                            <span class="spinner-border spinner-border-sm me-2"></span>
                        }
                        Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show"></div>
}

<!-- Modal de Confirmación para Reenviar Solicitud -->
@if (showConfirmarReenvioModal)
{
    <div class="modal fade show" style="display: block;" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #8a1538; color: white;">
                    <h5 class="modal-title">
                        <i class="bi bi-arrow-repeat"></i> Confirmar Reenvío
                    </h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="CancelarReenvio"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>¿Está seguro que desea reenviar esta solicitud para revisión?</strong>
                    </div>
                    <p class="mb-0">Esta acción enviará la solicitud nuevamente al administrador para su revisión.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="CancelarReenvio">
                        <i class="bi bi-x-lg"></i> Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" @onclick="ConfirmarReenvio" 
                            disabled="@isProcessing" style="background-color: #8a1538; border-color: #8a1538;">
                        @if (isProcessing)
                        {
                            <span class="spinner-border spinner-border-sm me-2"></span>
                        }
                        else
                        {
                            <i class="bi bi-arrow-repeat"></i>
                        }
                        Reenviar Solicitud
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show"></div>
}

<!-- Modal de Confirmación para Eliminar Solicitud -->
@if (showConfirmarEliminarSolicitudModal)
{
    <div class="modal fade show" style="display: block;" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-trash"></i> Confirmar Eliminación
                    </h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="CancelarEliminarSolicitud"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>¿Está seguro que desea eliminar esta solicitud?</strong>
                    </div>
                    <div class="alert alert-warning">
                        <strong>⚠️ Advertencia:</strong> Esta acción no se puede deshacer. La solicitud será eliminada permanentemente.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="CancelarEliminarSolicitud">
                        <i class="bi bi-x-lg"></i> Cancelar
                    </button>
                    <button type="button" class="btn btn-danger" @onclick="ConfirmarEliminarSolicitud" 
                            disabled="@isProcessing">
                        @if (isProcessing)
                        {
                            <span class="spinner-border spinner-border-sm me-2"></span>
                        }
                        else
                        {
                            <i class="bi bi-trash"></i>
                        }
                        Eliminar Solicitud
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show"></div>
}

<!-- Modal de Confirmación para Eliminar Certificado -->
@if (showConfirmarEliminarCertificadoModal)
{
    <div class="modal fade show" style="display: block;" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-trash"></i> Confirmar Eliminación
                    </h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="CancelarEliminarCertificado"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>¿Está seguro de que desea eliminar este certificado?</strong>
                    </div>
                    <div class="alert alert-warning">
                        <strong>⚠️ Advertencia:</strong> Esta acción no se puede deshacer. El certificado será eliminado permanentemente.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="CancelarEliminarCertificado">
                        <i class="bi bi-x-lg"></i> Cancelar
                    </button>
                    <button type="button" class="btn btn-danger" @onclick="ConfirmarEliminarCertificado" 
                            disabled="@isProcessing">
                        @if (isProcessing)
                        {
                            <span class="spinner-border spinner-border-sm me-2"></span>
                        }
                        else
                        {
                            <i class="bi bi-trash"></i>
                        }
                        Eliminar Certificado
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-backdrop fade show"></div>
}

@code {
    // Referencias a los componentes modales
    private ObrasAcademicasModal? obrasModal;
    private CertificadosCapacitacionModal? certificadosModal;

    // Variables para obras académicas
    private List<ObraAcademicaDetalleDto>? todasSolicitudesObras;
    private bool isLoadingObras = true;
    private bool showObrasModal = false;
    private bool isEnviandoObras = false;
    
    // Variables para certificados de capacitación
    private List<CertificadoCapacitacionDetalleDto> todasSolicitudesCertificados = new();
    private bool isLoadingCertificados = false;
    private bool showCertificadosModal = false;
    
    // Variables para gestión de documentos
    private ObraAcademicaDetalleDto? solicitudSeleccionada;
    private CertificadoCapacitacionDetalleDto? certificadoSeleccionado = null;
    private bool showMotivoRechazoModal = false;
    private bool showEditarMetadatosModal = false;
    private bool showReemplazarArchivoModal = false;
    private bool showAgregarComentarioModal = false;
    private bool showVisualizarPDFModal = false;
    private bool isProcessing = false;
    
    // Variables para editar metadatos
    private EditarMetadatosSolicitudDto metadatosEdicion = new();
    
    // Variables para reemplazar archivo
    private InputFile? inputFileReemplazo;
    private string archivoReemplazoNombre = string.Empty;
    private string archivoReemplazoContenido = string.Empty;
    
    // Variables para comentarios
    private string nuevoComentario = string.Empty;
    
    // Variables para visualizar PDF
    private string? pdfUrl;
    private string? pdfNombreArchivo;
    private bool isLoadingPDF = false;
    private string? errorPDF;

    // Variables adicionales para certificados
    private bool showEditarCertificadoModal = false;
    private EditarMetadatosCertificadoDto? editarCertificadoDto = null;

    // Variables para modales de confirmación (reemplazar alerts)
    private bool showConfirmarReenvioModal = false;
    private bool showConfirmarEliminarSolicitudModal = false;
    private bool showConfirmarEliminarCertificadoModal = false;
    private Guid solicitudIdParaAccion = Guid.Empty;
    private Guid certificadoIdParaEliminar = Guid.Empty;

    protected override async Task OnInitializedAsync()
    {
        await LoadAllData();
    }

    private async Task LoadAllData()
    {
        await Task.WhenAll(
            LoadTodasSolicitudesObras(),
            LoadTodasSolicitudesCertificados()
        );
    }

    // Métodos para Obras Académicas
    private async Task LoadTodasSolicitudesObras()
    {
        try
        {
            isLoadingObras = true;
            todasSolicitudesObras = await DocumentosService.LoadTodasSolicitudesObrasAsync();
        }
        finally
        {
            isLoadingObras = false;
        }
    }

    private void ShowObrasModal()
    {
        showObrasModal = true;
        StateHasChanged();
    }

    private void CloseObrasModal()
    {
        showObrasModal = false;
        StateHasChanged();
    }

    private async Task EnviarSolicitudObras()
    {
        if (obrasModal == null) return;

        var nuevasObras = obrasModal.GetNuevasObras();
        var comentarios = obrasModal.GetComentarios();

        if (!nuevasObras.Any() || !nuevasObras.All(o => 
            !string.IsNullOrWhiteSpace(o.Titulo) && 
            !string.IsNullOrWhiteSpace(o.TipoObra) && 
            o.FechaPublicacion != default))
        {
            ToastService.ShowWarning("Por favor complete todos los campos obligatorios.");
            return;
        }

        try
        {
            isEnviandoObras = true;
            StateHasChanged();

            var solicitud = new SolicitudObrasAcademicasDto
            {
                Obras = nuevasObras,
                Comentarios = comentarios
            };

            var success = await DocumentosService.EnviarSolicitudObrasAsync(solicitud);
            
            if (success)
            {
                CloseObrasModal();
                await LoadTodasSolicitudesObras();
            }
        }
        finally
        {
            isEnviandoObras = false;
            StateHasChanged();
        }
    }

    // Métodos para Certificados
    private async Task LoadTodasSolicitudesCertificados()
    {
        try
        {
            isLoadingCertificados = true;
            todasSolicitudesCertificados = await DocumentosService.LoadTodasSolicitudesCertificadosAsync() ?? new List<CertificadoCapacitacionDetalleDto>();
        }
        finally
        {
            isLoadingCertificados = false;
        }
    }

    private void ShowCertificadosModal()
    {
        showCertificadosModal = true;
    }

    private void CerrarCertificadosModal()
    {
        showCertificadosModal = false;
        if (certificadosModal != null)
        {
            certificadosModal.LimpiarFormulario();
        }
    }

    private async Task GuardarCertificados()
    {
        if (certificadosModal == null) return;

        var certificados = certificadosModal.GetNuevosCertificados();
        
        if (!certificados.Any() || !certificados.All(c => 
            !string.IsNullOrWhiteSpace(c.NombreCurso) && 
            !string.IsNullOrWhiteSpace(c.InstitucionOfertante) &&
            !string.IsNullOrWhiteSpace(c.TipoCapacitacion) &&
            !string.IsNullOrWhiteSpace(c.Modalidad) &&
            c.HorasDuracion > 0 &&
            c.FechaInicio != default &&
            c.FechaFin != default &&
            !string.IsNullOrEmpty(c.ArchivoContenido)))
        {
            ToastService.ShowWarning("Por favor complete todos los campos obligatorios.");
            return;
        }

        try
        {
            isEnviandoObras = true;
            
            var solicitud = new SolicitarCertificadosCapacitacionDto
            {
                Certificados = certificados
            };

            var token = await LocalStorage.GetItemAsync<string>("authToken");
            Http.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
            
            var response = await Http.PostAsJsonAsync("api/certificados-capacitacion/solicitar", solicitud);
            
            if (response.IsSuccessStatusCode)
            {
                ToastService.ShowSuccess("Certificados enviados correctamente");
                CerrarCertificadosModal();
                await LoadTodasSolicitudesCertificados();
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                ToastService.ShowError($"Error al enviar certificados: {error}");
            }
        }
        catch (Exception ex)
        {
            ToastService.ShowError($"Error: {ex.Message}");
        }
        finally
        {
            isEnviandoObras = false;
        }
    }

    // Event handlers para los componentes
    private async Task VisualizarDocumento(Guid solicitudId)
    {
        try
        {
            isLoadingPDF = true;
            errorPDF = null;
            
            var result = await DocumentVisualizationService.VisualizarObraAcademica(solicitudId);
            
            if (result.Success)
            {
                pdfUrl = result.PdfUrl;
                pdfNombreArchivo = result.FileName;
                showVisualizarPDFModal = true;
            }
            else
            {
                errorPDF = result.ErrorMessage;
            }
        }
        finallyarReenvioModal = true;
        {
            isLoadingPDF = false;
        }te async Task ConfirmarReenvio()
    }

    private async Task DescargarDocumento(Guid solicitudId)
    {
        await DocumentVisualizationService.DescargarObraAcademica(solicitudId);isProcessing = true;
    }
ar token = await LocalStorage.GetItemAsync<string>("authToken");
    private void MostrarEditarMetadatos(ObraAcademicaDetalleDto solicitud)ders.AuthenticationHeaderValue("Bearer", token);
    {
        solicitudSeleccionada = solicitud;ar response = await Http.PutAsync($"api/obraacademicas/reenviar/{solicitudIdParaAccion}", null);
        metadatosEdicion = new EditarMetadatosSolicitudDto
        {f (response.IsSuccessStatusCode)
            Titulo = solicitud.Titulo,
            Descripcion = solicitud.Descripcion,   ToastService.ShowSuccess("Solicitud reenviada correctamente");
            TipoObra = solicitud.TipoObra,       await LoadTodasSolicitudesObras();
            FechaPublicacion = solicitud.FechaPublicacion,
            Editorial = solicitud.Editorial,   else
            Revista = solicitud.Revista,
            ISBN_ISSN = solicitud.ISBN_ISSN,       ToastService.ShowError("Error al reenviar la solicitud");
            DOI = solicitud.DOI,       }
            EsIndexada = solicitud.EsIndexada,        }
            IndiceIndexacion = solicitud.IndiceIndexacion,
            Autores = solicitud.Autores
        };
        showEditarMetadatosModal = true;arEliminarSolicitudModal = true;
    }

    private void MostrarReemplazarArchivo(ObraAcademicaDetalleDto solicitud)te async Task ConfirmarEliminarSolicitud()
    {
        solicitudSeleccionada = solicitud;
        archivoReemplazoNombre = string.Empty;
        archivoReemplazoContenido = string.Empty;
        showReemplazarArchivoModal = true;isProcessing = true;
    }
ar token = await LocalStorage.GetItemAsync<string>("authToken");
    private void MostrarMotivoRechazo(ObraAcademicaDetalleDto solicitud)ders.AuthenticationHeaderValue("Bearer", token);
    {
        solicitudSeleccionada = solicitud;ar response = await Http.DeleteAsync($"api/obraacademicas/eliminar/{solicitudIdParaAccion}");
        showMotivoRechazoModal = true;
    }f (response.IsSuccessStatusCode)

    private void MostrarAgregarComentario(ObraAcademicaDetalleDto solicitud)   ToastService.ShowSuccess("Solicitud eliminada correctamente");
    {       await LoadTodasSolicitudesObras();
        solicitudSeleccionada = solicitud;
        nuevoComentario = string.Empty;   else
        showAgregarComentarioModal = true;
    }       ToastService.ShowError("Error al eliminar la solicitud");
       }
    private async Task ReenviarSolicitud(Guid solicitudId)        }
    {
        if (!await JSRuntime.InvokeAsync<bool>("confirm", "¿Está seguro que desea reenviar esta solicitud para revisión?"))
            return;       ToastService.ShowError($"Error: {ex.Message}");
        
        tryinally
        {
            var token = await LocalStorage.GetItemAsync<string>("authToken");alse;
            Http.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);solicitudIdParaAccion = Guid.Empty;
            
            var response = await Http.PutAsync($"api/obraacademicas/reenviar/{solicitudId}", null);
            
            if (response.IsSuccessStatusCode)oid CancelarEliminarSolicitud()
            {
                ToastService.ShowSuccess("Solicitud reenviada correctamente");;
                await LoadTodasSolicitudesObras();
            }
            elseresponse = await Http.DeleteAsync($"api/obraacademicas/eliminar/{solicitudId}");
            {
                ToastService.ShowError("Error al reenviar la solicitud");
            }
        }       ToastService.ShowSuccess("Solicitud eliminada correctamente");
        catch (Exception ex) await LoadTodasSolicitudesObras();
        {   }
            ToastService.ShowError($"Error: {ex.Message}");
        }   {
    }           ToastService.ShowError("Error al eliminar la solicitud");
            }
    private async Task EliminarSolicitud(Guid solicitudId)
    {   catch (Exception ex)
        if (!await JSRuntime.InvokeAsync<bool>("confirm", "¿Está seguro que desea eliminar esta solicitud? Esta acción no se puede deshacer."))
            return;       ToastService.ShowError($"Error: {ex.Message}");
                }
        try
        {
            var token = await LocalStorage.GetItemAsync<string>("authToken");
            Http.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
            
            var response = await Http.DeleteAsync($"api/obraacademicas/eliminar/{solicitudId}");
            
            if (response.IsSuccessStatusCode)
            {
                ToastService.ShowSuccess("Solicitud eliminada correctamente");
                await LoadTodasSolicitudesObras();rvice.VisualizarCertificado(certificadoId);
            }
            else
            {
                ToastService.ShowError("Error al eliminar la solicitud");
            }      pdfNombreArchivo = result.FileName;
        }rue;
        catch (Exception ex)       }
        {            else
            ToastService.ShowError($"Error: {ex.Message}");
        }           errorPDF = result.ErrorMessage;
    }

    // Event handlers para certificados   finally
    private async Task VisualizarCertificado(Guid certificadoId)        {
    {
        try   }
        {
            isLoadingPDF = true;
            errorPDF = null;
            
            var result = await DocumentVisualizationService.VisualizarCertificado(certificadoId);        await DocumentVisualizationService.DescargarCertificado(certificadoId);
            
            if (result.Success)
            {
                pdfUrl = result.PdfUrl;arEliminarCertificadoModal = true;
                pdfNombreArchivo = result.FileName;
                showVisualizarPDFModal = true;
            }te async Task ConfirmarEliminarCertificado()
            else
            {
                errorPDF = result.ErrorMessage;
            }
        }isProcessing = true;
        finally
        {ar token = await LocalStorage.GetItemAsync<string>("authToken");
            isLoadingPDF = false;rs.AuthenticationHeaderValue("Bearer", token);
        }
    }ar response = await Http.DeleteAsync($"api/certificados-capacitacion/eliminar/{certificadoIdParaEliminar}");

    private async Task DescargarCertificado(Guid certificadoId)f (response.IsSuccessStatusCode)
    {
        await DocumentVisualizationService.DescargarCertificado(certificadoId);   ToastService.ShowSuccess("Certificado eliminado correctamente");
    }       await LoadTodasSolicitudesCertificados();

    private void EditarCertificado(CertificadoCapacitacionDetalleDto certificado)   else
    {
        certificadoSeleccionado = certificado;       ToastService.ShowError("Error al eliminar el certificado");
        editarCertificadoDto = new EditarMetadatosCertificadoDto       }
        {        }
            NombreCurso = certificado.NombreCurso,
            InstitucionOfertante = certificado.InstitucionOfertante,
            TipoCapacitacion = certificado.TipoCapacitacion,       ToastService.ShowError($"Error: {ex.Message}");
            FechaInicio = certificado.FechaInicio,
            FechaFin = certificado.FechaFin,
            HorasDuracion = certificado.HorasDuracion,
            Modalidad = certificado.Modalidad, = false;
            NumeroRegistro = certificado.NumeroRegistro,       certificadoIdParaEliminar = Guid.Empty;
            AreaTematica = certificado.AreaTematica,        }
            Descripcion = certificado.Descripcion
        };
        showEditarCertificadoModal = true;
    }
wConfirmarEliminarCertificadoModal = false;
    private void ReemplazarArchivoCertificado(CertificadoCapacitacionDetalleDto certificado)ertificadoIdParaEliminar = Guid.Empty;
    {
        certificadoSeleccionado = certificado;void VerMotivoRechazoCertificado(CertificadoCapacitacionDetalleDto certificado)
        showEditarCertificadoModal = true; // Reutilizar modal de edición
    }
ostrar información del rechazo
    private void VerMotivoRechazoCertificado(CertificadoCapacitacionDetalleDto certificado)
    {
        certificadoSeleccionado = certificado;
        // Mostrar información del rechazosync Task EliminarCertificado(Guid certificadoId)
        ToastService.ShowInfo($"Motivo de rechazo: {certificado.MotivoRechazo ?? "No especificado"}");
    }onfirm", "¿Está seguro de que desea eliminar este certificado?"))

    private async Task EliminarCertificado(Guid certificadoId)
    {
        if (!await JSRuntime.InvokeAsync<bool>("confirm", "¿Está seguro de que desea eliminar este certificado?"))
            return;;
        ttp.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
        try   
        {wait Http.DeleteAsync($"api/certificados-capacitacion/eliminar/{certificadoId}");
            var token = await LocalStorage.GetItemAsync<string>("authToken");   
            Http.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
               {
            var response = await Http.DeleteAsync($"api/certificados-capacitacion/eliminar/{certificadoId}"); ToastService.ShowSuccess("Certificado eliminado correctamente");
                   await LoadTodasSolicitudesCertificados();
            if (response.IsSuccessStatusCode)
            {   else
                ToastService.ShowSuccess("Certificado eliminado correctamente");       {
                await LoadTodasSolicitudesCertificados();                ToastService.ShowError("Error al eliminar el certificado");
            }
            else   }
            {x)
                ToastService.ShowError("Error al eliminar el certificado");
            }   ToastService.ShowError($"Error: {ex.Message}");
        }
        catch (Exception ex)
        {
            ToastService.ShowError($"Error: {ex.Message}");
        }
    }

    // Métodos auxiliares para modales y operacionesl = null;
    private void CerrarVisualizarPDF()
    {PDF = null;
        showVisualizarPDFModal = false;
        pdfUrl = null;
        pdfNombreArchivo = null;
        errorPDF = null;
    }f (solicitudSeleccionada?.SolicitudId == null) return;

    private async Task GuardarMetadatos()ry
    {
        if (solicitudSeleccionada?.SolicitudId == null) return;   isProcessing = true;
               
        try        var token = await LocalStorage.GetItemAsync<string>("authToken");
        {horization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
            isProcessing = true;       
            SolicitudId}", metadatosEdicion);
            var token = await LocalStorage.GetItemAsync<string>("authToken");    
            Http.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token); if (response.IsSuccessStatusCode)
               {
            var response = await Http.PutAsJsonAsync($"api/obraacademicas/editar-metadatos/{solicitudSeleccionada.SolicitudId}", metadatosEdicion);wSuccess("Metadatos actualizados correctamente");
                showEditarMetadatosModal = false;
            if (response.IsSuccessStatusCode)
            {
                ToastService.ShowSuccess("Metadatos actualizados correctamente");
                showEditarMetadatosModal = false;
                await LoadTodasSolicitudesObras();l actualizar los metadatos");
            }
            else
            {
                ToastService.ShowError("Error al actualizar los metadatos");
            }ToastService.ShowError($"Error: {ex.Message}");
        }
        catch (Exception ex)lly
        {
            ToastService.ShowError($"Error: {ex.Message}");sProcessing = false;
        }
        finally
        {
            isProcessing = false;sync Task OnFileChangeReemplazo(InputFileChangeEventArgs e)
        }
    }ile = e.File;

    private async Task OnFileChangeReemplazo(InputFileChangeEventArgs e)
    {   try
        var file = e.File;
        if (file != null && file.Size <= 10 * 1024 * 1024) // 10MB max       archivoReemplazoNombre = file.Name;
        { 1024 * 1024);
            try       using var memoryStream = new MemoryStream();
            { await stream.CopyToAsync(memoryStream);
                archivoReemplazoNombre = file.Name;       archivoReemplazoContenido = Convert.ToBase64String(memoryStream.ToArray());
                using var stream = file.OpenReadStream(10 * 1024 * 1024);
                using var memoryStream = new MemoryStream();   catch (Exception ex)
                await stream.CopyToAsync(memoryStream);       {
                archivoReemplazoContenido = Convert.ToBase64String(memoryStream.ToArray());            ToastService.ShowError($"Error al leer el archivo: {ex.Message}");
            }tring.Empty;
            catch (Exception ex)           archivoReemplazoContenido = string.Empty;
            {
                ToastService.ShowError($"Error al leer el archivo: {ex.Message}");}
                archivoReemplazoNombre = string.Empty;e
                archivoReemplazoContenido = string.Empty;
            }or("El archivo debe ser menor a 10MB");
        }
        else
        {
            ToastService.ShowError("El archivo debe ser menor a 10MB");
        }
    }solicitudSeleccionada?.SolicitudId == null || string.IsNullOrEmpty(archivoReemplazoContenido)) return;
    
    private async Task ReemplazarArchivo()
    {
        if (solicitudSeleccionada?.SolicitudId == null || string.IsNullOrEmpty(archivoReemplazoContenido)) return;sProcessing = true;
        
        tryvoDto
        {
            isProcessing = true;   ArchivoNombre = archivoReemplazoNombre,
            ArchivoContenido = archivoReemplazoContenido,
            var reemplazarDto = new ReemplazarArchivoDto   ArchivoTipo = "application/pdf"
            {
                ArchivoNombre = archivoReemplazoNombre,
                ArchivoContenido = archivoReemplazoContenido,   var token = await LocalStorage.GetItemAsync<string>("authToken");
                ArchivoTipo = "application/pdf"estHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
            };   
            obraacademicas/reemplazar-archivo/{solicitudSeleccionada.SolicitudId}", reemplazarDto);
            var token = await LocalStorage.GetItemAsync<string>("authToken");   
            Http.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);(response.IsSuccessStatusCode)
               {
            var response = await Http.PutAsJsonAsync($"api/obraacademicas/reemplazar-archivo/{solicitudSeleccionada.SolicitudId}", reemplazarDto);Success("Archivo reemplazado correctamente");
                   showReemplazarArchivoModal = false;
            if (response.IsSuccessStatusCode)           await LoadTodasSolicitudesObras();
            {            }
                ToastService.ShowSuccess("Archivo reemplazado correctamente");
                showReemplazarArchivoModal = false;
                await LoadTodasSolicitudesObras();           ToastService.ShowError("Error al reemplazar el archivo");
            }
            else
            {
                ToastService.ShowError("Error al reemplazar el archivo");   {
            }            ToastService.ShowError($"Error: {ex.Message}");
        }
        catch (Exception ex)   finally
        {
            ToastService.ShowError($"Error: {ex.Message}");    isProcessing = false;
        }
        finally
        {
            isProcessing = false;async Task GuardarComentario()
        }
    }
    
    private async Task GuardarComentario()
    {
        if (solicitudSeleccionada?.SolicitudId == null || string.IsNullOrWhiteSpace(nuevoComentario)) return;
        
        try
        {
            isProcessing = true;tring>("authToken");
            ttp.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
            var comentarioDto = new { Comentario = nuevoComentario };
            ar response = await Http.PostAsJsonAsync($"api/obraacademicas/agregar-comentario/{solicitudSeleccionada.SolicitudId}", comentarioDto);
            var token = await LocalStorage.GetItemAsync<string>("authToken");
            Http.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);f (response.IsSuccessStatusCode)
               {
            var response = await Http.PostAsJsonAsync($"api/obraacademicas/agregar-comentario/{solicitudSeleccionada.SolicitudId}", comentarioDto);.ShowSuccess("Comentario agregado correctamente");
                   showAgregarComentarioModal = false;
            if (response.IsSuccessStatusCode)
            {   }
                ToastService.ShowSuccess("Comentario agregado correctamente");e
                showAgregarComentarioModal = false;   {
                await LoadTodasSolicitudesObras();Error("Error al agregar el comentario");
            }   }
            else   }
            {        catch (Exception ex)
                ToastService.ShowError("Error al agregar el comentario");
            }{ex.Message}");
        }   }
        catch (Exception ex)
        {
            ToastService.ShowError($"Error: {ex.Message}");
        }
        finally
        {
            isProcessing = false;
        }l()
    }

    // Métodos para certificados
    private void CerrarEditarCertificadoModal()   certificadoSeleccionado = null;
    {    }
        showEditarCertificadoModal = false;
        editarCertificadoDto = null;rivate async Task GuardarEdicionCertificado()
        certificadoSeleccionado = null;
    }== null) return;

    private async Task GuardarEdicionCertificado()   try
    {        {
        if (editarCertificadoDto == null || certificadoSeleccionado == null) return;
               
        try("authToken");
        {tp.Headers.AuthenticationHeaderValue("Bearer", token);
            isProcessing = true;
            ync($"api/certificados-capacitacion/editar-metadatos/{certificadoSeleccionado.Id}", editarCertificadoDto);
            var token = await LocalStorage.GetItemAsync<string>("authToken");
            Http.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
            
            var response = await Http.PutAsJsonAsync($"api/certificados-capacitacion/editar-metadatos/{certificadoSeleccionado.Id}", editarCertificadoDto);do actualizado correctamente");
            
            if (response.IsSuccessStatusCode)icados();
            {       }
                ToastService.ShowSuccess("Certificado actualizado correctamente");            else
                CerrarEditarCertificadoModal();
                await LoadTodasSolicitudesCertificados();           ToastService.ShowError("Error al actualizar el certificado");
            }
            else
            {
                ToastService.ShowError("Error al actualizar el certificado");
            }e}");
        }
        catch (Exception ex)
        {
            ToastService.ShowError($"Error: {ex.Message}");
        }
        finally
        {
            isProcessing = false;
        }o
    }
g.Empty;
    // DTOs necesarios para el funcionamiento   public string TipoObra { get; set; } = string.Empty;
    public class EditarMetadatosSolicitudDto        public DateTime FechaPublicacion { get; set; }
    {
        public string Titulo { get; set; } = string.Empty;   public string? Revista { get; set; }
        public string TipoObra { get; set; } = string.Empty;et; set; }
        public DateTime FechaPublicacion { get; set; }
        public string? Editorial { get; set; }
        public string? Revista { get; set; }
        public string? ISBN_ISSN { get; set; }
        public string? DOI { get; set; } }
        public bool EsIndexada { get; set; }
        public string? IndiceIndexacion { get; set; }
        public string? Autores { get; set; }
        public string? Descripcion { get; set; }
    }} = string.Empty;
t; set; } = string.Empty;
    public class ReemplazarArchivoDtostring.Empty;
    {
        public string ArchivoNombre { get; set; } = string.Empty;
        public string ArchivoContenido { get; set; } = string.Empty;    public class EditarMetadatosCertificadoDto
        public string ArchivoTipo { get; set; } = string.Empty;
    }   public string NombreCurso { get; set; } = string.Empty;
;
    public class EditarMetadatosCertificadoDtot; } = string.Empty;
    {   public DateTime FechaInicio { get; set; }
        public string NombreCurso { get; set; } = string.Empty;        public DateTime FechaFin { get; set; }
        public string InstitucionOfertante { get; set; } = string.Empty;; set; }
        public string TipoCapacitacion { get; set; } = string.Empty;   public string Modalidad { get; set; } = string.Empty;
        public DateTime FechaInicio { get; set; }
        public DateTime FechaFin { get; set; }
        public int HorasDuracion { get; set; }
        public string Modalidad { get; set; } = string.Empty;
        public string? NumeroRegistro { get; set; }
        public string? AreaTematica { get; set; }
        public string? Descripcion { get; set; }
    }

    public class ObraAcademicaDetalleDto string.Empty;
    {tring.Empty;
        public int Id { get; set; }t; }
        public Guid? SolicitudId { get; set; }
        public string Titulo { get; set; } = string.Empty;
        public string TipoObra { get; set; } = string.Empty;   public string? ISBN_ISSN { get; set; }
        public DateTime FechaPublicacion { get; set; }        public string? DOI { get; set; }
        public string? Editorial { get; set; }
        public string? Revista { get; set; }   public string? IndiceIndexacion { get; set; }
        public string? ISBN_ISSN { get; set; }
        public string? DOI { get; set; }   public string? Descripcion { get; set; }
        public bool EsIndexada { get; set; }        public string? Estado { get; set; }
        public string? IndiceIndexacion { get; set; }; set; }
        public string? Autores { get; set; }   public string? MotivoRechazo { get; set; }
        public string? Descripcion { get; set; }
        public string? Estado { get; set; }
        public string? ComentariosRevision { get; set; }
        public string? MotivoRechazo { get; set; }
    }
} = string.Empty;
    public class CertificadoCapacitacionDetalleDtoring.Empty;
    {} = string.Empty;
        public Guid Id { get; set; }
        public string NombreCurso { get; set; } = string.Empty;
        public string InstitucionOfertante { get; set; } = string.Empty;
        public string TipoCapacitacion { get; set; } = string.Empty;g.Empty;
        public DateTime FechaInicio { get; set; }; }
        public DateTime FechaFin { get; set; }   public string? AreaTematica { get; set; }
        public int HorasDuracion { get; set; }       public string? Descripcion { get; set; }























































}    }        public string? ArchivoTipo { get; set; }        public string? ArchivoContenido { get; set; }        public string? ArchivoNombre { get; set; }        public string? Descripcion { get; set; }        public string? AreaTematica { get; set; }        public string? NumeroRegistro { get; set; }        public string Modalidad { get; set; } = string.Empty;        public int HorasDuracion { get; set; }        public DateTime FechaFin { get; set; } = DateTime.Today;        public DateTime FechaInicio { get; set; } = DateTime.Today;        public string TipoCapacitacion { get; set; } = string.Empty;        public string InstitucionOfertante { get; set; } = string.Empty;        public string NombreCurso { get; set; } = string.Empty;    {    public class CrearCertificadoCapacitacionDto    }        public List<CrearCertificadoCapacitacionDto> Certificados { get; set; } = new();    {    public class SolicitarCertificadosCapacitacionDto    }        public string? ArchivoTipo { get; set; }        public string? ArchivoContenido { get; set; }        public string? ArchivoNombre { get; set; }        public string? Descripcion { get; set; }        public string? Autores { get; set; }        public string? IndiceIndexacion { get; set; }        public bool EsIndexada { get; set; }        public string? DOI { get; set; }        public string? ISBN_ISSN { get; set; }        public string? Revista { get; set; }        public string? Editorial { get; set; }        public DateTime FechaPublicacion { get; set; } = DateTime.Today;        public string TipoObra { get; set; } = string.Empty;        public string Titulo { get; set; } = string.Empty;    {    public class NuevaObraAcademicaDto    }        public string? Comentarios { get; set; }        public List<NuevaObraAcademicaDto> Obras { get; set; } = new();    {    public class SolicitudObrasAcademicasDto    }        public string? ComentariosRevision { get; set; }        public string? MotivoRechazo { get; set; }        public string? Estado { get; set; }        public string? Descripcion { get; set; }        public string? AreaTematica { get; set; }        public string? NumeroRegistro { get; set; }        public string Modalidad { get; set; } = string.Empty;        public string? Estado { get; set; }
        public string? MotivoRechazo { get; set; }
        public string? ComentariosRevision { get; set; }
    }

    public class SolicitudObrasAcademicasDto
    {
        public List<NuevaObraAcademicaDto> Obras { get; set; } = new();
        public string? Comentarios { get; set; }
    }

    public class NuevaObraAcademicaDto
    {
        public string Titulo { get; set; } = string.Empty;
        public string TipoObra { get; set; } = string.Empty;
        public DateTime FechaPublicacion { get; set; } = DateTime.Today;
        public string? Editorial { get; set; }
        public string? Revista { get; set; }
        public string? ISBN_ISSN { get; set; }
        public string? DOI { get; set; }
        public bool EsIndexada { get; set; }
        public string? IndiceIndexacion { get; set; }
        public string? Autores { get; set; }
        public string? Descripcion { get; set; }
        public string? ArchivoNombre { get; set; }
        public string? ArchivoContenido { get; set; }
        public string? ArchivoTipo { get; set; }
    }

    public class SolicitarCertificadosCapacitacionDto
    {
        public List<CrearCertificadoCapacitacionDto> Certificados { get; set; } = new();
    }

    public class CrearCertificadoCapacitacionDto
    {
        public string NombreCurso { get; set; } = string.Empty;
        public string InstitucionOfertante { get; set; } = string.Empty;
        public string TipoCapacitacion { get; set; } = string.Empty;
        public DateTime FechaInicio { get; set; } = DateTime.Today;
        public DateTime FechaFin { get; set; } = DateTime.Today;
        public int HorasDuracion { get; set; }
        public string Modalidad { get; set; } = string.Empty;
        public string? NumeroRegistro { get; set; }
        public string? AreaTematica { get; set; }
        public string? Descripcion { get; set; }
        public string? ArchivoNombre { get; set; }
        public string? ArchivoContenido { get; set; }
        public string? ArchivoTipo { get; set; }
    }
}