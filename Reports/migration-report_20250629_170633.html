<!DOCTYPE html>
<html>
<head>
    <title>Reporte de Migración - SGA</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #2196F3; color: white; padding: 20px; border-radius: 5px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #E8F5E8; border-color: #4CAF50; }
        .warning { background: #FFF3E0; border-color: #FF9800; }
        .error { background: #FFEBEE; border-color: #F44336; }
        .info { background: #E3F2FD; border-color: #2196F3; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f2f2f2; }
        .timestamp { color: #666; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="header">
        <h1>🚀 Reporte de Migración - Sistema SGA</h1>
        <p class="timestamp">Generado: 2025-06-29 17:06:34 | Duración: 0.01 minutos</p>
    </div>
    
    <div class="section info">
        <h2>📋 Información General</h2>
        <table>
            <tr><td><strong>Entorno</strong></td><td>Development</td></tr>
            <tr><td><strong>Proyecto</strong></td><td>main</td></tr>
            <tr><td><strong>Acción</strong></td><td>report</td></tr>
            <tr><td><strong>Base de Datos</strong></td><td>SGA_Main</td></tr>
            <tr><td><strong>Servidor</strong></td><td>.\SQLEXPRESS</td></tr>
        </table>
    </div>
    
    <div class="section success">
        <h2>📊 Estado de la Base de Datos</h2>
        <table>
            <tr><td><strong>Existe</strong></td><td>✅ Sí</td></tr>
            <tr><td><strong>Tablas</strong></td><td>7</td></tr>
            <tr><td><strong>Constraints</strong></td><td>7</td></tr>
            <tr><td><strong>Índices</strong></td><td>199</td></tr>
            <tr><td><strong>Tamaño</strong></td><td>16.00 MB</td></tr>
            <tr><td><strong>Migraciones</strong></td><td>1</td></tr>
            <tr><td><strong>Última Migración</strong></td><td>s</td></tr>
        </table>
    </div>
    
    <div class='section info'>
        <h2>📝 Migraciones Aplicadas</h2>
        <ul><li>20250629072927_InitialCreateWithConstraints</li>
    
    <div class="section info">
        <h2>⚙️ Configuración Utilizada</h2>
        <pre>{
  "environments": {
    "Development": {
      "connectionString": "Server=.\\SQLEXPRESS;Database=SGA_Main;Trusted_Connection=true;MultipleActiveResultSets=true",
      "serverInstance": ".\\SQLEXPRESS",
      "databaseName": "SGA_Main",
      "allowReset": true,
      "autoBackup": false,
      "requireConfirmation": false
    },
    "Staging": {
      "connectionString": "Server=.\\SQLEXPRESS;Database=SGA_Staging;Trusted_Connection=true;MultipleActiveResultSets=true",
      "serverInstance": ".\\SQLEXPRESS",
      "databaseName": "SGA_Staging",
      "allowReset": false,
      "autoBackup": true,
      "requireConfirmation": true
    },
    "Production": {
      "connectionString": "Server=.\\SQLEXPRESS;Database=SGA_Production;Trusted_Connection=true;MultipleActiveResultSets=true",
      "serverInstance": ".\\SQLEXPRESS",
      "databaseName": "SGA_Production",
      "allowReset": false,
      "autoBackup": true,
      "requireConfirmation": true
    }
  },
  "projects": {
    "main": {
      "projectPath": "SGA.Infrastructure",
      "startupProject": "SGA.Api",
      "contexts": [
        "@{name=ApplicationDbContext; contextClass=ApplicationDbContext; migrationPath=SGA.Infrastructure\\Migrations; scriptsPath=Scripts}"
      ]
    }
  },
  "scripts": {
    "preMigration": {
      "enabled": true,
      "path": "Scripts\\Pre-Migration",
      "pattern": "*.sql",
      "executeOrder": "alphabetical"
    },
    "postMigration": {
      "enabled": true,
      "path": "Scripts\\Post-Migration",
      "pattern": "*.sql",
      "executeOrder": "alphabetical"
    },
    "rollback": {
      "enabled": true,
      "path": "Scripts\\Rollback",
      "pattern": "*.sql",
      "executeOrder": "reverse-alphabetical"
    }
  },
  "backup": {
    "enabled": true,
    "path": "Backups",
    "retentionDays": 30,
    "compressionEnabled": true,
    "namingPattern": "{environment}_{database}_{timestamp}"
  },
  "logging": {
    "enabled": true,
    "path": "Logs\\Migrations",
    "level": "Info",
    "retentionDays": 90,
    "filePattern": "migration_{date}.log"
  },
  "validation": {
    "checkDatabaseExists": true,
    "checkMigrationHistory": true,
    "checkConstraints": true,
    "checkIndexes": true,
    "customValidationScripts": []
  },
  "cicd": {
    "enabled": false,
    "hooks": {
      "preMigration": [],
      "postMigration": [],
      "onFailure": [],
      "onSuccess": []
    }
  }
}</pre>
    </div>
    
    <div class="section">
        <h2>📄 Log de Ejecución</h2>
        <pre>[2025-06-29 17:02:52.728] [Success]   📂 Base de datos existe: ✅ Sí
[2025-06-29 17:02:52.736] [Info]   📋 Tablas: 0
[2025-06-29 17:02:52.744] [Info]   🔒 Constraints: 0
[2025-06-29 17:02:52.752] [Info]   📇 Índices: 0
[2025-06-29 17:02:52.760] [Info]   💾 Tamaño: Changed database context to 'SGA_Main'. 16.00  (1 rows affected) MB
[2025-06-29 17:02:52.775] [Info]   🚀 Migraciones aplicadas: 2
[2025-06-29 17:02:52.788] [Info]   🏷️ Última migración: 20250629072927_InitialCreateWithConstraints
[2025-06-29 17:02:52.797] [Warning]   💚 Estado general: Requiere atención
[2025-06-29 17:02:52.805] [Info] 📝 Migraciones aplicadas:
[2025-06-29 17:02:52.815] [Debug]     • Changed database context to 'SGA_Main'.
[2025-06-29 17:02:52.823] [Debug]     • 20250629072927_InitialCreateWithConstraints
[2025-06-29 17:02:52.834] [Error] ❌ Operación completada con errores
[2025-06-29 17:02:52.843] [Info] ⏱️ Duración total: 0.83 segundos
[2025-06-29 17:06:05.623] [Success] Framework inicializado correctamente
[2025-06-29 17:06:05.631] [Info] Entorno: Development | Proyecto: main
[2025-06-29 17:06:05.643] [Info] 🔍 Verificando estado actual del sistema...
[2025-06-29 17:06:05.657] [Debug] Ejecutando consulta: SELECT COUNT(*) FROM sys.databases WHERE name = 'SGA_Main'
[2025-06-29 17:06:05.754] [Debug] Resultado bruto: '          1  (1 rows affected)'
[2025-06-29 17:06:05.763] [Debug] Resultado limpio: '          1'
[2025-06-29 17:06:06.272] [Info] 📊 Estado de la Base de Datos:
[2025-06-29 17:06:06.288] [Success]   📂 Base de datos existe: ✅ Sí
[2025-06-29 17:06:06.307] [Info]   📋 Tablas: 7
[2025-06-29 17:06:06.331] [Info]   🔒 Constraints: 7
[2025-06-29 17:06:06.342] [Info]   📇 Índices: 199
[2025-06-29 17:06:06.350] [Info]   💾 Tamaño: 16.00 MB
[2025-06-29 17:06:06.358] [Info]   🚀 Migraciones aplicadas: 1
[2025-06-29 17:06:06.366] [Info]   🏷️ Última migración: s
[2025-06-29 17:06:06.374] [Success]   💚 Estado general: Saludable
[2025-06-29 17:06:06.381] [Info] 📝 Migraciones aplicadas:
[2025-06-29 17:06:06.389] [Debug]     • 20250629072927_InitialCreateWithConstraints
[2025-06-29 17:06:06.398] [Success] 🎉 Operación completada exitosamente
[2025-06-29 17:06:06.411] [Info] ⏱️ Duración total: 0.8 segundos
[2025-06-29 17:06:17.556] [Success] Framework inicializado correctamente
[2025-06-29 17:06:17.564] [Info] Entorno: Development | Proyecto: main
[2025-06-29 17:06:17.574] [Info] Backup omitido para entorno de desarrollo
[2025-06-29 17:06:17.583] [Error] ❌ Operación completada con errores
[2025-06-29 17:06:17.590] [Info] ⏱️ Duración total: 0.04 segundos
[2025-06-29 17:06:33.346] [Success] Framework inicializado correctamente
[2025-06-29 17:06:33.353] [Info] Entorno: Development | Proyecto: main
[2025-06-29 17:06:33.363] [Info] 📋 Generando reporte completo...
[2025-06-29 17:06:33.373] [Debug] Ejecutando consulta: SELECT COUNT(*) FROM sys.databases WHERE name = 'SGA_Main'
[2025-06-29 17:06:33.428] [Debug] Resultado bruto: '          1  (1 rows affected)'
[2025-06-29 17:06:33.437] [Debug] Resultado limpio: '          1'
[2025-06-29 17:06:33.820] [Success] 📋 Reporte generado: Reports\migration-report_20250629_170633.html
[2025-06-29 17:06:33.821] [Success] ✅ Reporte generado: Reports\migration-report_20250629_170633.html
[2025-06-29 17:06:33.832] [Success] 🎉 Operación completada exitosamente
[2025-06-29 17:06:33.840] [Info] 📋 Generando reporte de la operación...
[2025-06-29 17:06:33.848] [Debug] Ejecutando consulta: SELECT COUNT(*) FROM sys.databases WHERE name = 'SGA_Main'
[2025-06-29 17:06:33.906] [Debug] Resultado bruto: '          1  (1 rows affected)'
[2025-06-29 17:06:33.916] [Debug] Resultado limpio: '          1'
</pre>
    </div>
    
    <footer style="margin-top: 40px; text-align: center; color: #666; font-size: 0.9em;">
        <p>Generado por Framework de Migraciones SGA v2.0</p>
    </footer>
</body>
</html>
